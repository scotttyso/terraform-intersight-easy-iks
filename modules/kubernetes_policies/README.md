# Kubernetes Policies Module

## Use this module to create Kubernetes policies within the Intersight organization

Run the plan from the Terraform cloud workspace.

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_intersight"></a> [intersight](#requirement\_intersight) | 1.0.13 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_intersight"></a> [intersight](#provider\_intersight) | 1.0.13 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_addons_policies"></a> [addons\_policies](#module\_addons\_policies) | terraform-cisco-modules/imm/intersight//modules/addons_policies | n/a |
| <a name="module_container_runtime_policies"></a> [container\_runtime\_policies](#module\_container\_runtime\_policies) | terraform-cisco-modules/imm/intersight//modules/container_runtime_policies | n/a |
| <a name="module_ip_pools"></a> [ip\_pools](#module\_ip\_pools) | terraform-cisco-modules/imm/intersight//modules/ip_pools | n/a |
| <a name="module_kubernetes_version_policies"></a> [kubernetes\_version\_policies](#module\_kubernetes\_version\_policies) | ../../../terraform-intersight-imm/modules/kubernetes_version_policies | n/a |
| <a name="module_network_cidr_policies"></a> [network\_cidr\_policies](#module\_network\_cidr\_policies) | terraform-cisco-modules/imm/intersight//modules/network_cidr_policies | n/a |
| <a name="module_nodeos_configuration_policies"></a> [nodeos\_configuration\_policies](#module\_nodeos\_configuration\_policies) | terraform-cisco-modules/imm/intersight//modules/nodeos_configuration_policies | n/a |
| <a name="module_trusted_certificate_authorities"></a> [trusted\_certificate\_authorities](#module\_trusted\_certificate\_authorities) | terraform-cisco-modules/imm/intersight//modules/trusted_certificate_authorities | n/a |
| <a name="module_virtual_machine_infra_config"></a> [virtual\_machine\_infra\_config](#module\_virtual\_machine\_infra\_config) | terraform-cisco-modules/imm/intersight//modules/virtual_machine_infra_config | n/a |
| <a name="module_virtual_machine_instance_type"></a> [virtual\_machine\_instance\_type](#module\_virtual\_machine\_instance\_type) | terraform-cisco-modules/imm/intersight//modules/virtual_machine_instance_type | n/a |

## Resources

| Name | Type |
|------|------|
| [intersight_organization_organization.org_moid](https://registry.terraform.io/providers/CiscoDevNet/intersight/1.0.13/docs/data-sources/organization_organization) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_addons_policies"></a> [addons\_policies](#input\_addons\_policies) | Intersight Kubernetes Service Add-ons Variable Map.  Add-ons Options are {ccp-monitor\|kubernetes-dashboard} currently.<br>Key - Name of the Add-ons Policy<br>* description - A description for the policy.<br>* install\_strategy - Add-ons install strategy to determine whether an addon is installed if not present.<br>  - None - Unspecified install strategy.<br>  - NoAction - No install action performed.<br>  - InstallOnly - Only install in green field. No action in case of failure or removal.<br>  - Always - Attempt install if chart is not already installed.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* release\_name - Name for the helm release.<br>* release\_namespace - Namespace for the helm release.<br>* tags - List of key/value Attributes to Assign to the Policy.<br>* upgrade\_strategy - Addon upgrade strategy to determine whether an addon configuration is overwritten on upgrade.<br>  - None - Unspecified upgrade strategy.<br>  - NoAction - This choice enables No upgrades to be performed.<br>  - UpgradeOnly - Attempt upgrade if chart or overrides options change, no action on upgrade failure.<br>  - ReinstallOnFailure - Attempt upgrade first. Remove and install on upgrade failure.<br>  - AlwaysReinstall - Always remove older release and reinstall. | <pre>map(object(<br>    {<br>      description       = optional(string)<br>      install_strategy  = optional(string)<br>      organization      = optional(string)<br>      release_name      = optional(string)<br>      release_namespace = optional(string)<br>      tags              = optional(list(map(string)))<br>      upgrade_strategy  = optional(string)<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "install_strategy": "Always",<br>    "organization": "default",<br>    "release_name": "",<br>    "release_namespace": "",<br>    "tags": [],<br>    "upgrade_strategy": "UpgradeOnly"<br>  }<br>}</pre> | no |
| <a name="input_apikey"></a> [apikey](#input\_apikey) | Intersight API Key. | `string` | n/a | yes |
| <a name="input_container_runtime_http_password"></a> [container\_runtime\_http\_password](#input\_container\_runtime\_http\_password) | Password for the HTTP Proxy Server, If required. | `string` | `""` | no |
| <a name="input_container_runtime_https_password"></a> [container\_runtime\_https\_password](#input\_container\_runtime\_https\_password) | Password for the HTTPS Proxy Server, If required. | `string` | `""` | no |
| <a name="input_container_runtime_policies"></a> [container\_runtime\_policies](#input\_container\_runtime\_policies) | Intersight Container Runtime Policy Variable Map.<br>Key - Name of the Container Runtime Policy.<br>* description - A description for the policy.<br>* docker\_daemon\_bridge\_ip - Bridge IP (--bip) including Prefix (e.g., 172.17.0.5/24) that Docker will use for the default bridge network (docker0). Containers will connect to this if no other network is configured, not used by kubernetes pods because their network is managed by CNI. However this address space must not collide with other CIDRs on your networks, including the cluster's Service CIDR, Pod Network CIDR and IP Pools.<br>* docker\_no\_proxy - Used to optionally exclude hosts or ranges from going through the proxy server.<br>  Refer to https://docs.docker.com/network/proxy/ for details.<br>* http\_hostname - HTTP/HTTPS Proxy server FQDN or IP.<br>* http\_port - The HTTP Proxy port number. The port number of the HTTP/HTTPS proxy must be between 1 and 65535, inclusive.<br>* http\_protocol - Protocol to use for the HTTP/HTTPS Proxy.<br>  - http<br>  - https<br>* http\_username - The username for the HTTP/HTTPS Proxy.<br>* https\_hostname - HTTP/HTTPS Proxy server FQDN or IP.<br>* https\_port - The HTTPS Proxy port number. The port number of the HTTP/HTTPS proxy must be between 1 and 65535, inclusive.<br>* https\_protocol - Protocol to use for the HTTP/HTTPS Proxy.<br>  - http<br>  - https<br>* https\_username - The username for the HTTP/HTTPS Proxy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* tags - List of key/value Attributes to Assign to the Policy. | <pre>map(object(<br>    {<br>      description             = optional(string)<br>      docker_daemon_bridge_ip = optional(string)<br>      docker_no_proxy         = optional(list(string))<br>      http_hostname           = optional(string)<br>      http_port               = optional(number)<br>      http_protocol           = optional(string)<br>      http_username           = optional(string)<br>      https_hostname          = optional(string)<br>      https_port              = optional(number)<br>      https_protocol          = optional(string)<br>      https_username          = optional(string)<br>      organization            = optional(string)<br>      tags                    = optional(list(map(string)))<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "docker_daemon_bridge_ip": "",<br>    "docker_no_proxy": [],<br>    "http_hostname": "",<br>    "http_port": 8080,<br>    "http_protocol": "http",<br>    "http_username": "",<br>    "https_hostname": "",<br>    "https_port": 8443,<br>    "https_protocol": "https",<br>    "https_username": "",<br>    "organization": "default",<br>    "tags": []<br>  }<br>}</pre> | no |
| <a name="input_endpoint"></a> [endpoint](#input\_endpoint) | Intersight URL. | `string` | `"https://intersight.com"` | no |
| <a name="input_ip_pools"></a> [ip\_pools](#input\_ip\_pools) | key - Name of the IP Pool.<br>* Assignment order decides the order in which the next identifier is allocated.<br>  - default - (Default) Assignment order is decided by the system.<br>  - sequential - Identifiers are assigned in a sequential order.<br>* description - Description to Assign to the Pool.<br>* ipv4\_block - Map of Addresses to Assign to the Pool.<br>  - from - Starting IPv4 Address.<br>  - to - Ending IPv4 Address.<br>  - primary\_dns = Primary DNS Server to Assign to the Pool<br>  - secondary\_dns = Secondary DNS Server to Assign to the Pool<br>* ipv4\_config - IPv4 Configuration to assign to the ipv4\_blocks.<br>  - gateway - Gateway to assign to the pool.<br>  - netmask - Netmask to assign to the pool.<br>* ipv6\_block - Map of Addresses to Assign to the Pool.<br>  - from - Starting IPv6 Address.<br>  - pool\_size - Size of the IPv6 Address Block.<br>* ipv6\_config - IPv6 Configuration to assign to the ipv6\_blocks.<br>  - gateway - Gateway to assign to the pool.<br>  - netmask - Netmask to assign to the pool.<br>  - primary\_dns = Primary DNS Server to Assign to the Pool<br>  - secondary\_dns = Secondary DNS Server to Assign to the Pool<br>* organization - Name of the Intersight Organization to assign this pool to.  Default is default.<br>  - https://intersight.com/an/settings/organizations/<br>* tags - List of Key/Value Pairs to Assign as Attributes to the Pool. | <pre>map(object(<br>    {<br>      assignment_order = optional(string)<br>      description      = optional(string)<br>      ipv4_block       = optional(list(map(string)))<br>      ipv4_config = optional(map(object(<br>        {<br>          gateway       = string<br>          netmask       = string<br>          primary_dns   = optional(string)<br>          secondary_dns = optional(string)<br>        }<br>      )))<br>      ipv6_block = optional(list(map(string)))<br>      ipv6_config = optional(map(object(<br>        {<br>          gateway       = string<br>          prefix        = number<br>          primary_dns   = optional(string)<br>          secondary_dns = optional(string)<br>        }<br>      )))<br>      organization = optional(string)<br>      tags         = optional(list(map(string)))<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "assignment_order": "default",<br>    "description": "",<br>    "ipv4_block": [],<br>    "ipv4_config": {},<br>    "ipv6_block": [],<br>    "ipv6_config": {},<br>    "organization": "default",<br>    "tags": []<br>  }<br>}</pre> | no |
| <a name="input_kubernetes_version_policies"></a> [kubernetes\_version\_policies](#input\_kubernetes\_version\_policies) | Intersight Kubernetes Version Policy Variable Map.<br>Key - Name of the Kubernetes Version Policy<br>* description - A description for the policy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* tags - List of key/value Attributes to Assign to the Policy.<br>* version - Desired Kubernetes version.  Options are:<br>  - v1.19.5 | <pre>map(object(<br>    {<br>      description  = optional(string)<br>      organization = optional(string)<br>      tags         = optional(list(map(string)))<br>      version      = optional(string)<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "organization": "default",<br>    "tags": [],<br>    "version": "v1.19.5"<br>  }<br>}</pre> | no |
| <a name="input_network_cidr_policies"></a> [network\_cidr\_policies](#input\_network\_cidr\_policies) | Intersight Kubernetes Network CIDR Policy Variable Map.<br>Key - Name of the Network CIDR Policy.<br>* cni\_type - Supported CNI type. Currently we only support Calico.<br>  - Calico - Calico CNI plugin as described in https://github.com/projectcalico/cni-plugin<br>  - Aci - Cisco ACI Container Network Interface plugin.<br>* description - A description for the policy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* pod\_network\_cidr - CIDR block to allocate pod network IP addresses from.<br>* service\_cidr - Pod CIDR Block to be used to assign Pod IP Addresses.<br>* tags - tags - List of key/value Attributes to Assign to the Policy. | <pre>map(object(<br>    {<br>      cni_type         = optional(string)<br>      description      = optional(string)<br>      organization     = optional(string)<br>      pod_network_cidr = optional(string)<br>      service_cidr     = optional(string)<br>      tags             = optional(list(map(string)))<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "cni_type": "Calico",<br>    "description": "",<br>    "organization": "default",<br>    "pod_network_cidr": "100.64.0.0/16",<br>    "service_cidr": "100.65.0.0/16",<br>    "tags": []<br>  }<br>}</pre> | no |
| <a name="input_nodeos_configuration_policies"></a> [nodeos\_configuration\_policies](#input\_nodeos\_configuration\_policies) | Intersight Kubernetes Node OS Configuration Policy Variable Map.<br>Key - Name of the Node OS Configuration Policy<br>* description - A description for the policy.<br>* dns\_servers - DNS Servers for the Kubernetes Node OS Configuration Policy.<br>* dns\_suffix - Domain Name for the Kubernetes Node OS Configuration Policy.<br>* ntp\_servers - NTP Servers for the Kubernetes Node OS Configuration Policy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* tags - tags - List of key/value Attributes to Assign to the Policy.<br>* timezone - The timezone of the node's system clock.  For a List of supported timezones see the following URL:<br>  - https://github.com/terraform-cisco-modules/terraform-intersight-imm/blob/master/modules/policies_ntp/README.md. | <pre>map(object(<br>    {<br>      description  = optional(string)<br>      dns_servers  = optional(list(string))<br>      dns_suffix   = optional(string)<br>      ntp_servers  = optional(list(string))<br>      organization = optional(string)<br>      tags         = optional(list(map(string)))<br>      timezone     = optional(string)<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "dns_servers": [<br>      "208.67.220.220",<br>      "208.67.222.222"<br>    ],<br>    "dns_suffix": "example.com",<br>    "ntp_servers": [],<br>    "organization": "default",<br>    "tags": [],<br>    "timezone": "Etc/GMT"<br>  }<br>}</pre> | no |
| <a name="input_organizations"></a> [organizations](#input\_organizations) | Intersight Organization Names to Apply Policy to.  https://intersight.com/an/settings/organizations/. | `set(string)` | n/a | yes |
| <a name="input_secretkey"></a> [secretkey](#input\_secretkey) | Intersight Secret Key. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | Please Refer to the tags variable information in the tfe module.  In the k8s\_policies module the variable is accepted as a string from terraform cloud in the terraform.auto.tfvars and extracted using locals. | `list(map(string))` | n/a | yes |
| <a name="input_trusted_certificate_authorities"></a> [trusted\_certificate\_authorities](#input\_trusted\_certificate\_authorities) | Intersight Kubernetes Trusted Registry Policy Variable Map.<br>Key - Name of the Trusted Certificate Authorities Policy<br>* description - A description for the policy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* root\_ca\_registries - The list of root CA certificates to trust.<br>* tags - List of key/value Attributes to Assign to the Policy.<br>* unsigned\_registries - The list of unsigned registries to allow docker trust.. | <pre>map(object(<br>    {<br>      description         = optional(string)<br>      organization        = optional(string)<br>      root_ca_registries  = optional(list(string))<br>      tags                = optional(list(map(string)))<br>      unsigned_registries = optional(list(string))<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "organization": "default",<br>    "root_ca": [],<br>    "tags": [],<br>    "unsigned": []<br>  }<br>}</pre> | no |
| <a name="input_virtual_machine_infra_config"></a> [virtual\_machine\_infra\_config](#input\_virtual\_machine\_infra\_config) | Intersight Kubernetes Virtual Machine Infra Config Policy Variable Map.<br>Key - Name of the Virtual Machine Infra Config Policy<br>* description - A description for the policy.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* tags - List of key/value Attributes to Assign to the Policy.<br>* vsphere\_cluster - vSphere Cluster to assign the K8S Cluster Deployment.<br>* vsphere\_datastore - vSphere Datastore to assign the K8S Cluster Deployment.r\n<br>* vsphere\_portgroup - vSphere Port Group to assign the K8S Cluster Deployment.r\n<br>* vsphere\_resource\_pool - vSphere Resource Pool to assign the K8S Cluster Deployment.r\n<br>* vsphere\_target - Name of the vSphere Target discovered in Intersight, to provision the cluster on. | <pre>map(object(<br>    {<br>      description           = optional(string)<br>      organization          = optional(string)<br>      tags                  = optional(list(map(string)))<br>      vsphere_cluster       = string<br>      vsphere_datastore     = string<br>      vsphere_portgroup     = list(string)<br>      vsphere_resource_pool = optional(string)<br>      vsphere_target        = string<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "description": "",<br>    "organization": "default",<br>    "tags": [],<br>    "vsphere_cluster": "default",<br>    "vsphere_datastore": "datastore1",<br>    "vsphere_portgroup": [<br>      "VM Network"<br>    ],<br>    "vsphere_resource_pool": "",<br>    "vsphere_target": ""<br>  }<br>}</pre> | no |
| <a name="input_virtual_machine_instance_type"></a> [virtual\_machine\_instance\_type](#input\_virtual\_machine\_instance\_type) | Intersight Kubernetes Virtual Machine Instance Type Policy Variable Map.<br>Key - Name of the Virtual Machine Instance Type Policy<br>* cpu - Number of CPUs allocated to virtual machine.  Range is 1-40.<br>* description - A description for the policy.<br>* memory - Virtual machine memory defined in mebibytes (MiB).  Range is 1-4177920.<br>* organization - Name of the Intersight Organization to assign this pool to.<br>  - https://intersight.com/an/settings/organizations/<br>* system\_disk\_size - Ephemeral disk capacity to be provided with units example - 10 for 10 Gigabytes.<br>* tags - List of key/value Attributes to Assign to the Policy. | <pre>map(object(<br>    {<br>      cpu              = optional(number)<br>      description      = optional(string)<br>      memory           = optional(number)<br>      organization     = optional(string)<br>      system_disk_size = optional(number)<br>      tags             = optional(list(map(string)))<br>    }<br>  ))</pre> | <pre>{<br>  "default": {<br>    "cpu": 4,<br>    "description": "",<br>    "memory": 16384,<br>    "organization": "default",<br>    "system_disk_size": 40,<br>    "tags": []<br>  }<br>}</pre> | no |
| <a name="input_vsphere_password"></a> [vsphere\_password](#input\_vsphere\_password) | vSphere Password.  Note: this is the password of the Credentials used to register the vSphere Target. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_addons_policies"></a> [addons\_policies](#output\_addons\_policies) | moid of the Kubernetes Addon Policies. |
| <a name="output_container_runtime_policies"></a> [container\_runtime\_policies](#output\_container\_runtime\_policies) | moid of the Kubernetes Runtime Policies. |
| <a name="output_endpoint"></a> [endpoint](#output\_endpoint) | Intersight URL. |
| <a name="output_ip_pools"></a> [ip\_pools](#output\_ip\_pools) | moid of the IP Pools. |
| <a name="output_kubernetes_version_policies"></a> [kubernetes\_version\_policies](#output\_kubernetes\_version\_policies) | moid of the Kubernetes Version Policies. |
| <a name="output_network_cidr_policies"></a> [network\_cidr\_policies](#output\_network\_cidr\_policies) | moid of the Kubernetes Network CIDR Policies. |
| <a name="output_nodeos_configuration_policies"></a> [nodeos\_configuration\_policies](#output\_nodeos\_configuration\_policies) | moid of the Kubernetes Node OS Config Policies. |
| <a name="output_org_moids"></a> [org\_moids](#output\_org\_moids) | n/a |
| <a name="output_tags"></a> [tags](#output\_tags) | Tags to be Associated with Objects Created in Intersight. |
| <a name="output_trusted_certificate_authorities"></a> [trusted\_certificate\_authorities](#output\_trusted\_certificate\_authorities) | moid of the Kubernetes Trusted Certificate Authorities Policy. |
| <a name="output_virtual_machine_infra_config"></a> [virtual\_machine\_infra\_config](#output\_virtual\_machine\_infra\_config) | moid of the Kubernetes Virtual Machine Infrastructure Configuration Policies. |
| <a name="output_virtual_machine_instance_type"></a> [virtual\_machine\_instance\_type](#output\_virtual\_machine\_instance\_type) | moid of the Virtual Machine Instance Type Policies. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
